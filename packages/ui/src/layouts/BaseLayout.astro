---
/**
 * BaseLayout.astro - Shared base layout for all Holi.tools apps
 *
 * Provides:
 * - Canvas grid background
 * - Language menu positioning
 * - Color palette system
 * - SEO meta tags
 * - GRIDSIZE: GRID DOT SIZE ('SM' | 'MD' | 'LG', DEFAULT: 'MD')
 */

interface Language {
  readonly code: string;
  readonly name: string;
}

interface Props {
  title: string;
  description?: string;
  lang: string;
  languages: readonly Language[];
  colorScheme?: "default" | "qr" | "paint" | "calculator" | "labs" | "typst";

  showCanvasGrid?: boolean;
  gridSize?: "sm" | "md" | "lg";

  version?: string;
  changelog?: { version: string; date: string; changes: string[] }[];
  changelogLabels?: { title?: string; current?: string; footer?: string };
}

const {
  title,
  description,
  lang,
  languages,
  colorScheme = "default",

  showCanvasGrid = true,
  gridSize = "md",

  version,
  changelog,
  changelogLabels,
} = Astro.props;

import ConfigMenu from "../components/ConfigMenu.astro";
import VersionBadge from "../components/VersionBadge.astro";
import ChangelogOverlay from "../components/ChangelogOverlay.astro";

// Import styles as Astro modules
import "../styles/design-system.css";
import "../styles/palettes.css";

// Build body classes
const bodyClasses = [
  `palette-${colorScheme}`,
  showCanvasGrid ? "canvas-background" : "",
  showCanvasGrid ? `canvas-dots-${gridSize}` : "",
]
  .filter(Boolean)
  .join(" ");
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <title>{title}</title>
    {description && <meta name="description" content={description} />}


    <slot name="head" />

    <style>
      /* Base styles */
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        color: var(--color-text);
        overflow-x: hidden;
      }
    </style>
  </head>

  <body class={bodyClasses}>
    <!-- Language Menu (if enabled) -->
    <!-- Floating Configuration Orb (Replaces Header) -->
    <div class="floating-menu-container">
      <ConfigMenu
        currentLang={lang}
        languages={languages}
        homeHref="/"
        changelogId={version && changelog ? colorScheme : undefined}
      />
    </div>

    <!-- Main content slot -->
    <slot />

    {version && <VersionBadge version={version} changelogId={colorScheme} />}
    {version && changelog && (
      <ChangelogOverlay 
        id={colorScheme} 
        currentVersion={version} 
        history={changelog}
        labels={changelogLabels}
      />
    )}
  </body>
</html>

---
import HeroTitle from "../components/HeroTitle.astro";
import HeroValues from "../components/HeroValues.astro";
import ToolsExplorer from "../components/ToolsExplorer.astro";
import Overlay from "../components/Overlay.astro";
import SoundEngine from "../components/SoundEngine.astro";
import ThemeManager from "../components/ThemeManager.astro";
import { getTranslations, languages } from "../i18n/translations";

const lang = Astro.currentLocale || "en";
const t = getTranslations(lang);
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={t.info_privacy_text} />
    <meta name="generator" content={Astro.generator} />
    <title>Holi.tools - {t.hero_slogan}</title>
    <style>
      :root {
        --color-bg: #ffffff;
        --color-text: #1a1a1a;
        --color-border: #1a1a1a;
        --color-accent: #8f00ff;
        --color-card-bg: #ffffff;

        --rainbow-gradient: linear-gradient(
          90deg,
          #ff0000,
          #ff7f00,
          #ffff00,
          #00ff00,
          #0000ff,
          #4b0082,
          #8f00ff
        );
      }
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        background-color: var(--color-bg);
        color: var(--color-text);
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        transition:
          background-color 0.3s ease,
          color 0.3s ease;
      }
      .dvh-container {
        display: flex;
        flex-direction: column;
        min-height: 100dvh;
      }

      header {
        background: var(--color-bg);
        width: 100%;
        min-height: 50dvh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        transition: background-color 0.3s ease;
        padding-bottom: 2rem;
        gap: 2rem;
      }
    </style>
    <style is:global>
      /* Global Overlay Content Styles (Must be global because they are injected via JS) */
      .overlay-title {
        font-size: clamp(1.5rem, 6vw, 3rem);
        font-weight: 900;
        text-transform: lowercase;
        margin-bottom: 2rem;
        line-height: 0.9;
        border-bottom: 4px solid var(--color-border);
        padding-bottom: 0.5rem;
        display: inline-block;
        color: var(--color-text);
      }
      .overlay-text {
        font-size: clamp(1rem, 2.5vw, 1.3rem);
        line-height: 1.5;
        color: var(--color-text);
        font-weight: 400;
      }
      .lang-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 0.75rem;
        width: 100%;
        margin-top: 1rem;
      }
      .lang-link {
        background: var(--color-card-bg);
        border: 2px solid var(--color-border);
        padding: 0.8rem;
        font-weight: 800;
        font-size: 0.9rem;
        cursor: pointer;
        text-transform: lowercase;
        transition: all 0.1s steps(2);
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        text-decoration: none;
        color: var(--color-text);
      }
      .lang-link:hover {
        background: var(--color-accent);
        color: var(--color-bg);
        transform: translate(-4px, -4px);
        box-shadow: 4px 4px 0px var(--color-border);
      }
      .lang-link.active {
        background: var(--color-text);
        color: var(--color-bg);
      }
    </style>
  </head>
  <body>
    <div class="dvh-container">
      <header>
        <HeroTitle />
        <HeroValues />
      </header>

      <ToolsExplorer />
    </div>

    <Overlay />
    <SoundEngine />
    <ThemeManager />

    <script define:vars={{ t, languages, lang }}>
      // Clientside logic for the overlay and simple I18N bridges
      window.I18N = {
        lang,
        t,
        languages,
      };

      function openOverlay(type, id = "") {
        const body = document.getElementById("OverlayBody");
        const container = document.getElementById("OverlaySystem");

        if (!body || !container) return;

        if (type === "languages") {
          const title = window.I18N.t.lang_title || "idioma / language";
          let html = `<h2 class="overlay-title">${title}</h2><div class="lang-grid">`;
          window.I18N.languages.forEach((l) => {
            const path = l.code === "en" ? "/" : `/${l.code}/`;
            const isActive = window.I18N.lang === l.code ? "active" : "";
            html += `<a href="${path}" class="lang-link ${isActive}" data-lang="${l.code}">${l.name}</a>`;
          });
          html += `</div>`;
          body.innerHTML = html;

          body.querySelectorAll(".lang-link").forEach((el) => {
            el.addEventListener("click", () => {
              const lang = el.getAttribute("data-lang");
              if (lang) localStorage.setItem("selectedLang", lang);
            });
          });
        } else if (type === "info") {
          const title = window.I18N.t[`info_${id}_title`] || id;
          const text = window.I18N.t[`info_${id}_text`] || "...";
          body.innerHTML = `
            <h2 class="overlay-title">${title}</h2>
            <p class="overlay-text">${text}</p>
          `;
        }

        container.classList.add("active");
      }

      // Event Delegation
      document.addEventListener("click", (e) => {
        const target = e.target;
        if (!target) return;

        const item = target.closest(".prop-item");
        if (item) {
          const id = item.id;
          if (id === "languages") {
            openOverlay("languages");
          } else {
            openOverlay("info", id);
          }
          return;
        }

        if (target.id === "CloseOverlay" || target.id === "OverlaySystem") {
          const overlay = document.getElementById("OverlaySystem");
          if (overlay) overlay.classList.remove("active");
        }
      });
    </script>
  </body>
</html>

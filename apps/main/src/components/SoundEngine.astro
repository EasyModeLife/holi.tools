---

---

<div id="AudioCursor" class="audio-cursor">click para activar audio</div>

<style>
  .audio-cursor {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    background: #1a1a1a;
    color: white;
    padding: 0.4rem 0.8rem;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: lowercase;
    opacity: 0;
    z-index: 9999;
    border: 1px solid white;
    box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
    transition: opacity 0.3s ease;
    white-space: nowrap;
  }
</style>

<script>
  class SoundEngine {
    private ctx: AudioContext | null = null;
    private masterGain: GainNode | null = null;
    private audioEnabled: boolean = false;
    private cursor: HTMLElement | null = null;

    init() {
      this.cursor = document.getElementById("AudioCursor");

      const updateCursor = (e: MouseEvent) => {
        if (this.cursor && !this.audioEnabled) {
          this.cursor.style.transform = `translate(${e.clientX + 15}px, ${e.clientY + 15}px)`;
          this.cursor.style.opacity = "1";
        }
      };

      document.addEventListener("mousemove", updateCursor);

      const enable = () => {
        if (!this.ctx) {
          this.ctx = new (
            window.AudioContext || (window as any).webkitAudioContext
          )();
          // Create Master Gain for global volume control without affecting envelopes
          this.masterGain = this.ctx.createGain();
          this.masterGain.gain.value = 2.0; // Global 200% volume boost
          this.masterGain.connect(this.ctx.destination);
        }
        if (this.ctx.state === "suspended") {
          this.ctx.resume();
        }
        this.audioEnabled = true;
        if (this.cursor) {
          this.cursor.style.opacity = "0";
          setTimeout(() => this.cursor?.remove(), 300);
        }
        document.removeEventListener("mousemove", updateCursor);
        window.removeEventListener("click", enable);
      };

      window.addEventListener("click", enable);
    }

    playHover() {
      if (!this.audioEnabled || !this.ctx || !this.masterGain) return;

      const t = this.ctx.currentTime;
      const osc = this.ctx.createOscillator();
      const gain = this.ctx.createGain();

      osc.type = "sine";
      osc.frequency.setValueAtTime(800, t);
      osc.frequency.exponentialRampToValueAtTime(600, t + 0.05);

      // Reverted to original pleasant gain "shape"
      gain.gain.setValueAtTime(0.015, t);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.05);

      osc.connect(gain);
      gain.connect(this.masterGain); // Connect to master instead of destination

      osc.start(t);
      osc.stop(t + 0.05);
    }

    playClick() {
      if (!this.audioEnabled || !this.ctx || !this.masterGain) return;

      const t = this.ctx.currentTime;
      const osc = this.ctx.createOscillator();
      const gain = this.ctx.createGain();

      // Drum-like "thud" (tom)
      osc.type = "sine";
      osc.frequency.setValueAtTime(150, t);
      osc.frequency.exponentialRampToValueAtTime(40, t + 0.1);

      // Reverted to original pleasant gain "shape"
      gain.gain.setValueAtTime(0.2, t);
      gain.gain.exponentialRampToValueAtTime(0.001, t + 0.1);

      osc.connect(gain);
      gain.connect(this.masterGain); // Connect to master instead of destination

      osc.start(t);
      osc.stop(t + 0.1);
    }
  }

  const engine = new SoundEngine();
  engine.init();

  // Global listeners for sound
  document.addEventListener("mouseover", (e) => {
    const target = e.target as HTMLElement;
    if (target.closest(".prop-item") || target.closest(".tool-card")) {
      engine.playHover();
    }
  });

  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;
    if (
      target.closest(".prop-item") ||
      target.closest(".tool-card") ||
      target.closest(".lang-btn") ||
      target.closest(".lang-link")
    ) {
      engine.playClick();
    }
  });
</script>

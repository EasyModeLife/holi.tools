---
/*
  ThemeManager.astro
  Handles client-side theme switching.
  Exposes window.toggleTheme() for the easter egg.
*/
---

<script>
  declare global {
    interface Window {
      toggleTheme: () => void;
    }
  }

  // Palettes Definition
  const themes = [
    {
      name: "default",
      colors: {
        "--color-bg": "#ffffff",
        "--color-text": "#1a1a1a",
        "--color-border": "#1a1a1a",
        "--color-accent": "#5B21B6",
        "--color-card-bg": "#ffffff",
      },
    },
    {
      name: "tokyo-night",
      colors: {
        "--color-bg": "#1a1b26",
        "--color-text": "#c0caf5",
        "--color-border": "#7aa2f7",
        "--color-accent": "#bb9af7",
        "--color-card-bg": "#24283b",
      },
    },
    {
      name: "nord",
      colors: {
        "--color-bg": "#2E3440",
        "--color-text": "#ECEFF4",
        "--color-border": "#88C0D0",
        "--color-accent": "#81A1C1",
        "--color-card-bg": "#3B4252",
      },
    },
    {
      name: "forest",
      colors: {
        "--color-bg": "#064E3B",
        "--color-text": "#D1FAE5",
        "--color-border": "#34D399",
        "--color-accent": "#10B981",
        "--color-card-bg": "#065F46",
      },
    },
    {
      name: "sage",
      colors: {
        "--color-bg": "#1A2F23",
        "--color-text": "#E8EFEA",
        "--color-border": "#4ADE80",
        "--color-accent": "#22C55E",
        "--color-card-bg": "#243E36",
      },
    },
    {
      name: "lavender",
      colors: {
        "--color-bg": "#2E1065",
        "--color-text": "#E9D5FF",
        "--color-border": "#A78BFA",
        "--color-accent": "#C4B5FD",
        "--color-card-bg": "#4C1D95",
      },
    },
  ];

  let currentThemeIndex = 0;

  function applyTheme(index, save = true) {
    const theme = themes[index];
    const root = document.documentElement;
    Object.entries(theme.colors).forEach(([key, value]) => {
      root.style.setProperty(key, value);
    });
    if (save) {
      localStorage.setItem("selectedTheme", theme.name);
    }
    currentThemeIndex = index;
    console.log(`[ThemeManager] Applied theme: ${theme.name} (Saved: ${save})`);
  }

  // Expose global toggle function
  window.toggleTheme = () => {
    currentThemeIndex = (currentThemeIndex + 1) % themes.length;
    applyTheme(currentThemeIndex, true);
  };

  // Initialize: Always Random to satisfy "Uno random al entrar"
  // We ignore localStorage on initialization so it's fresh every time.
  const randomIndex = Math.floor(Math.random() * themes.length);
  applyTheme(randomIndex, false); // false = do not save to localStorage, so reload is still random
</script>

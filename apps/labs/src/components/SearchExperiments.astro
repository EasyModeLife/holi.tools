---
/**
 * SearchExperiments.astro
 * Client-side search for filtering experiment cards.
 */
import { getTranslations } from "../i18n/translations";

import Icon from "@holi/ui/components/Icon.astro";

const lang = Astro.currentLocale || "en";
---

<div class="search-container relative max-w-xl mx-auto mb-16">
  <div class="relative group">
    <div
      class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none"
    >
      <Icon
        name="search"
        size={20}
        class="text-white/20 group-focus-within:text-white/60 transition-colors"
      />
    </div>
    <input
      type="text"
      id="experiment-search"
      placeholder="filter experiments..."
      class="w-full bg-white/[0.02] border border-white/10 text-white rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:border-white/20 transition-all placeholder:text-white/20 text-sm tracking-tight"
    />
    <div
      class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
    >
      <span
        class="text-[9px] uppercase tracking-tighter text-white/10 border border-white/5 rounded px-1.5 py-0.5"
        >CTRL K</span
      >
    </div>
  </div>
</div>

<script>
  function initSearch() {
    const searchInput = document.getElementById(
      "experiment-search"
    ) as HTMLInputElement;
    if (!searchInput) return;

    const cards = document.querySelectorAll(".experiment-card");

    // Search function
    const performSearch = (query: string) => {
      const lowerQuery = query.toLowerCase();

      cards.forEach((card) => {
        const title = card.getAttribute("data-title")?.toLowerCase() || "";
        const desc = card.getAttribute("data-desc")?.toLowerCase() || "";
        const tags = card.getAttribute("data-tags")?.toLowerCase() || "";

        const matches =
          title.includes(lowerQuery) ||
          desc.includes(lowerQuery) ||
          tags.includes(lowerQuery);

        (card as HTMLElement).style.display = matches ? "flex" : "none";
        // Apply fade-in animation for matches
        if (matches) {
          (card as HTMLElement).style.animation =
            "fadeIn 0.3s ease-out forwards";
        }
      });
    };

    // Event listener
    searchInput.addEventListener("input", (e) => {
      performSearch((e.target as HTMLInputElement).value);
    });

    // Keyboard shortcut (Ctrl/Cmd + K)
    document.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "k") {
        e.preventDefault();
        searchInput.focus();
      }
      // Escape to clear/blur
      if (e.key === "Escape" && document.activeElement === searchInput) {
        searchInput.blur();
      }
    });
  }

  // Init on load
  initSearch();
  // Init on view transitions
  document.addEventListener("astro:page-load", initSearch);
</script>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

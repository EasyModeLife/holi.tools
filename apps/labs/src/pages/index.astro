---
import { getCollection } from "astro:content";
import BaseLayout from "@holi/ui/layouts/BaseLayout.astro";
import SimpleBackground from "@holi/ui/components/SimpleBackground.astro";
import SearchExperiments from "../components/SearchExperiments.astro";
import GlassCard from "@holi/ui/components/GlassCard.astro";
import { getTranslations, languages } from "../i18n/translations";

import "../styles/app.css";
import Icon from "@holi/ui/components/Icon.astro";
import { labsAppChangelog } from "@holi/configs/changelogs";

const lang = Astro.currentLocale || "en";
const t = getTranslations(lang);

// Get all experiments from content collection, sorted by order
const experiments = (await getCollection("experiments")).sort(
  (a, b) => (a.data.order ?? 0) - (b.data.order ?? 0)
);

const history = labsAppChangelog;
---

<BaseLayout
  title={t.meta_title}
  description={t.meta_description}
  lang={lang}
  languages={languages}
  colorScheme="labs"
  version="0.1.1"
  changelog={history}
>
  <SimpleBackground />

  <main class="container mx-auto px-4 py-20 relative z-10">
    <section class="max-w-4xl mx-auto text-center mb-16">
      <h1
        class="text-7xl md:text-9xl font-black mb-4 tracking-tighter text-white lowercase"
      >
        Labs
      </h1>
      <p
        class="text-xl md:text-2xl text-white/40 font-light max-w-2xl mx-auto tracking-tight"
      >
        {t.hero_slogan}
      </p>
    </section>

    <!-- Search Component -->
    <SearchExperiments />

    <section class="max-w-6xl mx-auto">
      <h2
        class="text-[10px] uppercase tracking-[0.4em] text-white/20 font-bold mb-12 text-center"
      >
        {t.experiments_title}
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {
          experiments.map((exp) => (
            <div
              class="experiment-card h-full"
              data-title={exp.data.title}
              data-desc={exp.data.description}
              data-tags={exp.data.tags.join(" ")}
            >
              <GlassCard
                clickable={true}
                padding="lg"
                rounded="lg"
                accentColor={exp.data.color}
                href={`/experiments/${exp.slug}`}
                intensity={1.2}
                class="group h-full"
              >
                <div
                  class="w-12 h-12 rounded-xl flex items-center justify-center mb-6 transition-colors bg-white/5 border border-white/10 text-white/40 group-hover:text-white"
                  style={`--card-hover-bg: ${exp.data.color}20;`}
                >
                  <Icon name={exp.data.icon} size={24} />
                </div>
                <h3 class="text-xl font-bold mb-2 text-white/90 tracking-tight">
                  {exp.data.title}
                </h3>
                <p class="text-white/40 leading-relaxed text-sm font-light mb-6">
                  {exp.data.description}
                </p>
                <div class="flex flex-wrap gap-2 mt-auto">
                  {exp.data.tags.map((tag: string) => (
                    <span class="text-[9px] uppercase tracking-widest px-2 py-1 rounded bg-white/5 text-white/30 border border-white/5 group-hover:border-white/10 transition-colors">
                      {tag}
                    </span>
                  ))}
                </div>
              </GlassCard>
            </div>
          ))
        }
      </div>
    </section>

    <footer class="mt-32 text-center">
      <a
        href="/"
        class="inline-flex items-center gap-2 text-white/40 hover:text-white transition-colors text-sm uppercase tracking-widest"
      >
        <Icon name="arrow_back" size={16} />
        {t.back_home}
      </a>
    </footer>
  </main>
</BaseLayout>

<style>
  main {
    min-height: 100vh;
  }

  h1 {
    font-family: inherit;
  }
</style>

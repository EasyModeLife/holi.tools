---
// QRHoli V4 - Bento Grid Sovereign UX
import EditorCanvas from "../components/EditorCanvas.astro";
import HUDControls from "../components/HUDControls.astro";
import BaseLayout from "@holi/ui/layouts/BaseLayout.astro";
import SimpleBackground from "@holi/ui/components/SimpleBackground.astro";

// Import local styles
import "../styles/app.css";
import { qrAppChangelog } from "@holi/configs/changelogs";

const lang = "es";
const history = (qrAppChangelog as any)[lang] || qrAppChangelog.en;
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Holi QR</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>
  <body>
    <BaseLayout
      title="Holi QR - Sovereign Bento"
      lang={lang}
      languages={[
        { code: "en", name: "English" },
        { code: "es", name: "EspaÃ±ol" },
      ]}
      colorScheme="qr"
      showCanvasGrid={false}
      version="0.1.1"
      changelog={history}
    >
      <SimpleBackground />
      <!-- HUD is now nested inside EditorCanvas -->
      <EditorCanvas />
    </BaseLayout>

    <script>
      import "../lib/icons";
      // Import the main controller which handles all logic
      import { qrController } from "../lib/qr-controller";
      import { getIconSvg } from "../lib/icons";

      // Prevent tree-shaking and expose for debugging
      (window as any).qrControllerApp = qrController;
      console.log("Main: qrController imported", qrController);

      // Initialize Material Icons as SVG
      function initAllIcons() {
        document.querySelectorAll(".icon, .material-icons").forEach((el) => {
          const textContent = el.textContent?.trim();
          if (
            textContent &&
            !el.querySelector("svg") &&
            textContent.match(/^[a-z_]+$/)
          ) {
            const svg = getIconSvg(textContent, 20);
            if (svg) (el as HTMLElement).innerHTML = svg;
          }
        });
      }

      if (document.readyState === "complete") {
        initAllIcons();
      } else {
        window.addEventListener("load", initAllIcons);
      }
    </script>
  </body>
</html>

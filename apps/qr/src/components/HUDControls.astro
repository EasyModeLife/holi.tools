---
// HUDControls.astro - Floating Heads-Up Display for QR Editing
---

<div class="hud-container">
  <!-- Floating Bar (The "Dock") -->
  <div class="hud-dock glass-panel">
    <button class="hud-btn" onclick="toggleHudPanel('content')" title="Content">
      <span class="icon">edit</span>
      <span class="hud-label">Content</span>
    </button>
    <div class="hud-sep"></div>
    <button class="hud-btn" onclick="toggleHudPanel('style')" title="Style">
      <span class="icon">palette</span>
      <span class="hud-label">Style</span>
    </button>
    <button class="hud-btn" onclick="toggleHudPanel('brand')" title="Branding">
      <span class="icon">verified</span>
      <span class="hud-label">Brand</span>
    </button>
    <div class="hud-sep"></div>
    <button class="hud-btn" onclick="toggleHudPanel('export')" title="Export">
      <span class="icon">download</span>
      <span class="hud-label">Export</span>
    </button>
  </div>

  <!-- POPOUT PANELS (Sprouting from the dock) -->

  <!-- CONTENT PANEL -->
  <div id="hud-panel-content" class="hud-panel glass-panel">
    <div class="panel-header">
      <span class="panel-title">QR Content</span>
      <button class="close-btn" onclick="closeHudPanels()">×</button>
    </div>

    <!-- Type Grid -->
    <div id="hud-content-grid" class="hud-grid-2col">
      <button class="hud-tile active" onclick="showHudContentForm('url')">
        <span class="icon">link</span> URL
      </button>
      <button class="hud-tile" onclick="showHudContentForm('text')">
        <span class="icon">text_fields</span> Text
      </button>
      <button class="hud-tile" onclick="showHudContentForm('wifi')">
        <span class="icon">wifi</span> WiFi
      </button>
      <button class="hud-tile" onclick="showHudContentForm('vcard')">
        <span class="icon">contact_page</span> vCard
      </button>
    </div>

    <!-- Forms (Slide in) -->
    <div id="hud-form-url" class="hud-form" style="display:none">
      <button class="btn-text-back" onclick="showHudContentGrid()">
        <span class="icon" style="font-size:14px">arrow_back</span> Back
      </button>
      <div class="input-wrapper margin-top-sm">
        <input
          type="text"
          id="url-input"
          class="hud-input"
          placeholder="https://site.com"
          autofocus
        />
        <button class="input-icon-right"
          ><span class="icon">content_paste</span></button
        >
      </div>
      <div class="hud-row margin-top-sm">
        <span class="hud-text-sm">Shorten URL</span>
        <label class="switch-mini">
          <input type="checkbox" />
          <span class="slider-mini"></span>
        </label>
      </div>
    </div>
  </div>

  <!-- STYLE PANEL -->
  <div id="hud-panel-style" class="hud-panel glass-panel">
    <div class="panel-header">
      <span class="panel-title">Style</span>
      <button class="close-btn" onclick="closeHudPanels()">×</button>
    </div>

    <div class="hud-section">
      <div class="hud-label-row">Colors</div>
      <div class="hud-row">
        <div class="color-picker-mini">
          <input
            type="color"
            id="ctrl-fg"
            value="#000000"
            oninput="updateQR()"
          />
        </div>
        <div class="color-picker-mini">
          <input
            type="color"
            id="ctrl-bg"
            value="#ffffff"
            oninput="updateQR()"
          />
        </div>
        <button
          class="icon-toggle"
          id="bg-transparent"
          onclick="toggleTransparent('bg')"
          title="Transparent BG"
        >
          <span class="icon">grid_on</span>
        </button>
      </div>
    </div>

    <div class="hud-section">
      <div class="hud-label-row">Pattern</div>
      <div class="hud-shape-grid">
        <button
          class="shape-btn active"
          data-bodyshape="square"
          onclick="setBodyShape('square')"
          ><svg viewBox="0 0 20 20"
            ><rect x="2" y="2" width="16" height="16" fill="currentColor"
            ></rect></svg
          ></button
        >
        <button
          class="shape-btn"
          data-bodyshape="rounded"
          onclick="setBodyShape('rounded')"
          ><svg viewBox="0 0 20 20"
            ><rect x="2" y="2" width="16" height="16" rx="4" fill="currentColor"
            ></rect></svg
          ></button
        >
        <button
          class="shape-btn"
          data-bodyshape="classy-rounded"
          onclick="setBodyShape('classy-rounded')"
          ><svg viewBox="0 0 20 20"
            ><rect x="3" y="3" width="14" height="14" rx="2" fill="currentColor"
            ></rect></svg
          ></button
        >
      </div>
    </div>
  </div>

  <!-- BRAND PANEL -->
  <div id="hud-panel-brand" class="hud-panel glass-panel">
    <div class="panel-header">
      <span class="panel-title">Brand</span>
      <button class="close-btn" onclick="closeHudPanels()">×</button>
    </div>
    <div class="hud-section">
      <div
        class="hud-upload-zone"
        onclick="document.getElementById('logo-input').click()"
      >
        <span class="icon">upload_file</span>
        <span>Upload Logo</span>
        <input
          type="file"
          id="logo-input"
          hidden
          accept="image/*"
          onchange="handleLogoUpload(event)"
        />
      </div>
      <!-- Preview container handled by JS -->
      <div
        id="logo-preview"
        style="display:none; margin-top:8px; justify-content:center; position:relative"
      >
        <img id="logo-img" style="height:32px" />
        <button
          onclick="removeLogo()"
          style="position:absolute; top:-4px; right:20px; color:red">×</button
        >
      </div>
    </div>
  </div>

  <!-- EXPORT PANEL -->
  <div id="hud-panel-export" class="hud-panel glass-panel">
    <div class="panel-header">
      <span class="panel-title">Export</span>
      <button class="close-btn" onclick="closeHudPanels()">×</button>
    </div>
    <div class="hud-section">
      <div class="hud-row">
        <input
          type="range"
          class="hud-range"
          min="500"
          max="4000"
          step="100"
          value="1000"
          oninput="setExportSize(this.value)"
        />
        <span class="hud-text-sm" id="export-size-val">1000px</span>
      </div>
      <div class="hud-actions margin-top-sm">
        <button class="hud-action-btn primary" onclick="downloadPNG()"
          >PNG</button
        >
        <button class="hud-action-btn" onclick="downloadQR()">SVG</button>
      </div>
    </div>
  </div>
</div>

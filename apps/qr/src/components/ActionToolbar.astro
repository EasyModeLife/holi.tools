---
/**
 * ActionToolbar.astro - Actions toolbar for QR Code
 *
 * Includes:
 * - Download button with menu
 * - Copy button
 * - Reset button
 * - Verify button
 */
---

<div class="action-toolbar">
  <div class="download-wrapper">
    <button class="action-btn" id="btn-download" title="Download">
      <span class="icon">download</span>
    </button>
    <div class="download-menu" id="download-menu">
      <button onclick="window.downloadAs && window.downloadAs('svg')">
        <span class="icon">code</span> SVG
      </button>
      <button onclick="window.downloadAs && window.downloadAs('png')">
        <span class="icon">image</span> PNG
      </button>
      <button onclick="window.downloadAs && window.downloadAs('jpg')">
        <span class="icon">photo</span> JPG
      </button>
      <button onclick="window.downloadAs && window.downloadAs('pdf')">
        <span class="icon">picture_as_pdf</span> PDF
      </button>
    </div>
  </div>
  <button class="action-btn" id="btn-copy" title="Copy">
    <span class="icon">content_copy</span>
  </button>
  <button class="action-btn" id="btn-reset" title="Reset">
    <span class="icon">refresh</span>
  </button>
  <div class="sep-vertical"></div>
  <button
    class="action-btn status-btn"
    id="btn-verify"
    title="Verification Status"
  >
    <span class="icon" id="verify-icon">verified_user</span>
  </button>
</div>

<style>
  /* Action Toolbar (Download, Copy, Reset) */
  .action-toolbar {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 24px;
    position: relative;
    z-index: 50;
  }

  .action-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--bg-card);
    border: 1px solid var(--border-main);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
  }
  .action-btn:hover {
    background: var(--text-main);
    color: var(--bg-body);
    border-color: var(--text-main);
    transform: scale(1.1);
  }

  /* Verify button states */
  .action-btn.valid {
    background: #22c55e;
    border-color: #22c55e;
    color: white;
  }
  .action-btn.invalid {
    background: #ef4444;
    border-color: #ef4444;
    color: white;
  }
  .action-btn.checking {
    background: #f59e0b;
    border-color: #f59e0b;
    color: white;
    animation: pulse 1s ease-in-out infinite;
  }

  .action-btn.success {
    background: #22c55e;
    border-color: #22c55e;
    color: white;
    transform: scale(1.1);
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.6;
    }
  }

  .sep-vertical {
    width: 1px;
    height: 24px;
    background: var(--border-main);
    margin: 0 4px;
    align-self: center;
  }

  .download-wrapper {
    position: relative;
  }

  .download-menu {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 8px;
    background: var(--bg-card, rgba(40, 40, 45, 0.98));
    border: 1px solid rgba(127, 127, 127, 0.15);
    border-radius: 12px;
    padding: 6px;
    display: none;
    flex-direction: column;
    gap: 4px;
    min-width: 120px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    z-index: 100;
  }

  @media (prefers-color-scheme: dark) {
    .download-menu {
      background: rgba(40, 40, 45, 0.98);
    }
  }

  .download-menu.show {
    display: flex;
  }

  .download-menu button {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: transparent;
    border: none;
    color: var(--text-main, white);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.2s;
  }

  @media (prefers-color-scheme: dark) {
    .download-menu button {
      color: white;
    }
  }

  .download-menu button:hover {
    background: rgba(127, 127, 127, 0.1);
  }
</style>

<script is:inline>
  (function () {
    // Download menu toggle
    const downloadBtn = document.getElementById("btn-download");
    const downloadMenu = document.getElementById("download-menu");
    if (downloadBtn && downloadMenu) {
      downloadBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        downloadMenu.classList.toggle("show");
      });
      // Close when clicking outside
      document.addEventListener("click", function (e) {
        if (!downloadMenu.contains(e.target) && e.target !== downloadBtn) {
          downloadMenu.classList.remove("show");
        }
      });
    }
  })();
</script>

---
/**
 * TypeGrid.astro - Grid of content types (Text, WiFi, etc.)
 * Shown when no content is entered (Zero state).
 * Using shared GlassCard for consistent styling.
 */

import GlassCard from "@holi/ui/components/GlassCard.astro";
import Icon from "@holi/ui/components/Icon.astro";
import { BRAND_ICONS } from "../lib/brand-logos";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const QR_TYPES = [
  { id: "url", icon: "link", label: t("type.url") },
  { id: "text", icon: "text_fields", label: t("type.text") },
  { id: "email", icon: "email", label: t("type.email") },
  { id: "phone", icon: "phone", label: t("type.phone") },
  { id: "sms", icon: "sms", label: t("type.sms") },
  { id: "vcard", icon: "contact_page", label: t("type.vcard") },
  { id: "wifi", icon: "wifi", label: t("type.wifi"), image: BRAND_ICONS.wifi },
  { id: "event", icon: "event", label: t("type.event") },
  { id: "location", icon: "location_on", label: t("type.location") },
  {
    id: "facebook",
    icon: "public",
    label: t("type.facebook"),
    image: BRAND_ICONS.facebook,
  },
  {
    id: "twitter",
    icon: "chat_bubble",
    label: t("type.twitter"),
    image: BRAND_ICONS.twitter,
  },
  {
    id: "youtube",
    icon: "smart_display",
    label: t("type.youtube"),
    image: BRAND_ICONS.youtube,
  },
  {
    id: "bitcoin",
    icon: "account_balance_wallet",
    label: t("type.bitcoin"),
    image: BRAND_ICONS.bitcoin,
  },
  {
    id: "appstore",
    icon: "apple",
    label: t("type.appstore"),
    image: BRAND_ICONS.appstore,
  },
  {
    id: "playstore",
    icon: "shop",
    label: t("type.playstore"),
    image: BRAND_ICONS.playstore,
  },
  { id: "scan", icon: "qr_code_scanner", label: t("input.scan_qr") },
];
---

<div class="type-grid-wrapper" id="type-grid-wrapper">
  <p class="helper-text">{t("typegrid.helper")}</p>
  <div class="type-grid">
    {
      QR_TYPES.map((type) => (
        <GlassCard
          as="button"
          class="type-card"
          padding="md"
          rounded="md"
          clickable
          data-type={type.id}
        >
          {type.image ? (
            <img
              src={type.image}
              alt={type.label}
              class="type-icon brand-logo"
            />
          ) : (
            <Icon name={type.icon} size={32} class="type-icon" />
          )}
          <span class="type-label">{type.label}</span>
        </GlassCard>
      ))
    }
  </div>
</div>

<script>
  // Type card click handlers - wait for DOM
  document.addEventListener("DOMContentLoaded", function () {
    var cards = document.querySelectorAll(".type-card");
    console.log("[TypeGrid] Found", cards.length, "type cards");

    cards.forEach(function (card) {
      card.addEventListener("click", function (e) {
        e.preventDefault();
        e.stopPropagation();
        var type = card.getAttribute("data-type");
        console.log("[TypeGrid] Clicked type:", type);

        if (type && (window as any).setContentType) {
          (window as any).setContentType(type);
          // Mobile: scroll to input
          if (window.innerWidth < 768) {
            var input = document.querySelector(".shared-input-container");
            if (input)
              input.scrollIntoView({ behavior: "smooth", block: "start" });
          }
        } else {
          console.warn("[TypeGrid] window.setContentType not found!");
        }
      });
    });
  });
</script>

<style>
  .type-grid-wrapper {
    text-align: center;
    transition: all 1s ease-out;
    width: 100%;
  }

  .helper-text {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 24px;
    opacity: 0.8;
  }

  .type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 16px;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    padding-bottom: 32px;
  }

  /* GlassCard overrides for type cards */
  :global(.type-card) {
    flex-direction: column !important;
    gap: 12px !important;
    min-height: 0 !important;
    height: auto !important;
  }

  .type-icon {
    font-size: 32px;
    opacity: 0.85;
    transition: all 0.2s;
  }

  .type-icon.brand-logo {
    width: 32px;
    height: 32px;
    object-fit: contain;
    border-radius: 8px;
  }

  :global(.type-card:hover) .type-icon {
    opacity: 1;
    transform: scale(1.1);
    color: var(--color-accent);
  }

  .type-label {
    font-size: 13px;
    font-weight: 600;
    white-space: nowrap;
  }

  /* Fade out when generating */
  :global(.canvas-container.generating) .type-grid-wrapper {
    opacity: 0;
    transform: scale(0.8);
    position: absolute;
    pointer-events: none;
  }

  /* Mobile */
  @media (max-width: 640px) {
    .type-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    :global(.type-card) {
      padding: 12px 8px !important;
    }

    .type-icon {
      font-size: 28px;
    }

    .type-icon.brand-logo {
      width: 28px;
      height: 28px;
    }

    .type-label {
      font-size: 11px;
    }
  }
</style>

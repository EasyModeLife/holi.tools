---
import DraggablePanelSystem from "./common/DraggablePanelSystem.astro";
import ToolPanel from "./common/ToolPanel.astro";
import ColorPanel from "./panels/ColorPanel.astro";
import ShapesPanel from "./panels/ShapesPanel.astro";
import EffectPanel from "./panels/EffectPanel.astro";
import ImagePanel from "./panels/ImagePanel.astro";
import AdvancedPanel from "./panels/AdvancedPanel.astro";
import QRInputArea from "./QRInputArea.astro";
import QRResultArea from "./QRResultArea.astro";
import TypeGrid from "./TypeGrid.astro";

// EditorCanvas.astro - Refactored modular version
---

<!-- Hideable Glass Header -->
<main class="canvas-container" id="canvas-container">
  <!-- HEADER (Fades out) -->
  <div class="hero-header">
    <h1 class="hero-title">Create a QR Code</h1>
    <p class="hero-subtitle">Enter your link or text below</p>
  </div>

  <!-- SHARED INPUT (Animates position) -->
  <QRInputArea />

  <!-- CONTENT AREA -->
  <div class="content-area">
    <!-- TYPE GRID (Fades out) -->
    <TypeGrid />

    <!-- QR RESULT (Fades in) -->
    <QRResultArea />
  </div>

  <!-- Tool Panels (using shared GlassCard) -->
  <ToolPanel id="color" title="Colors" initialX={100} initialY={150}>
    <ColorPanel />
  </ToolPanel>

  <ToolPanel id="shapes" title="Shapes" initialX={150} initialY={180}>
    <ShapesPanel />
  </ToolPanel>

  <ToolPanel id="effect" title="Effects" initialX={180} initialY={210}>
    <EffectPanel />
  </ToolPanel>

  <ToolPanel id="image" title="Image" initialX={200} initialY={250}>
    <ImagePanel />
  </ToolPanel>

  <ToolPanel id="advanced" title="Advanced" initialX={250} initialY={300}>
    <AdvancedPanel />
  </ToolPanel>
</main>

<!-- Panel System Control -->
<DraggablePanelSystem
  panelIds={["color", "shapes", "effect", "image", "advanced"]}
  panelSides={{
    color: "right",
    shapes: "right",
    effect: "right",
    image: "left",
    advanced: "left",
  }}
/>

<style>
  /* Global Layout Styles */
  .canvas-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    min-height: 100vh;
    overflow: auto;
    padding: 0;
    padding-bottom: 100px;
    position: relative;
    transition: all 0.3s ease;
  }

  .hero-header {
    padding: 60px 20px 20px;
    text-align: center;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    max-height: 300px;
    overflow: hidden;
    opacity: 1;
  }

  .canvas-container.generating .hero-header,
  :global(.canvas-container.generating .hero-header) {
    max-height: 0;
    padding: 0;
    opacity: 0;
    pointer-events: none;
  }

  .hero-title {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 8px;
    letter-spacing: -0.02em;
    color: var(--text-main);
  }

  .hero-subtitle {
    font-size: 1rem;
    color: var(--text-secondary);
  }

  .content-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
    width: 100%;
    width: 100%;
    padding: 20px;
    position: relative; /* For GPU overlay */
  }

  .gpu-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 300px; /* Match QR Frame default */
    height: 300px;
    pointer-events: none; /* Let clicks pass through to SVG for now */
    z-index: 10;
    display: block; /* ALWAYS VISIBLE for Liquid Mode */
  }
  .gpu-overlay.active {
    display: block;
  }
  #gpu-canvas {
    width: 100%;
    height: 100%;
  }
</style>
